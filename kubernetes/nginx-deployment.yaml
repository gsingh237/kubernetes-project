apiVersion: apps/v1
kind: Deployment
metadata:
  name: ingress-nginx-controller
  labels:
    #app.kubernetes.io/name: nginx-ingress
    #app: nginx-ingress
    #app.kubernetes.io/part-of: nginx-ingress
spec:
  replicas: 1
  selector:
    matchLabels:
      #app.kubernetes.io/name: nginx-ingress
      app: nginx-ingress
      #app.kubernetes.io/part-of: nginx-ingress
  template:
    metadata:
      labels:
        #app.kubernetes.io/name: nginx-ingress
        app: nginx-ingress
        #app.kubernetes.io/part-of: nginx-ingress
    spec:
      # hostNetwork makes it possible to use ipv6 and to preserve the source IP correctly regardless of docker configuration
      # however, it is not a hard dependency of the ingress-nginx-controller itself and it may cause issues if port 10254 already is taken on the host
      # that said, since hostPort is broken on CNI (https://github.com/kubernetes/kubernetes/issues/31307) we have to use hostNetwork where CNI is used
      # like with kubeadm
      # hostNetwork: true
      terminationGracePeriodSeconds: 60
      containers:
      #- image: registry.k8s.io/ingress-nginx/controller:v1.0.5
      #- image: nginx/nginx-ingress:latest
      - image: registry.k8s.io/ingress-nginx/controller:v1.8.2@sha256:74834d3d25b336b62cabeb8bf7f1d788706e2cf1cfd64022de4137ade8881ff2
      #- image: k8s.gcr.io/ingress-nginx/nginx-ingress-controller:v1.0.4
        name: controller
        #readinessProbe:
        #  httpGet:
        #    path: /healthz
        #    port: 10254
        #    scheme: HTTP
        #livenessProbe:
        #  httpGet:
        #    path: /healthz
        #    port: 10254
        #    scheme: HTTP
        #  initialDelaySeconds: 10
        #  timeoutSeconds: 1
        ports:
        - containerPort: 80
          hostPort: 80
          name: http
        - containerPort: 443
          hostPort: 443
          name: https
        #env:
        #  - name: POD_NAME
        #    valueFrom:
        #      fieldRef:
        #        fieldPath: metadata.name
        #  - name: POD_NAMESPACE
        #    valueFrom:
        #      fieldRef:
        #        fieldPath: metadata.namespace
        args:
        - /nginx-ingress-controller
        #- --publish-service=$(POD_NAMESPACE)/ingress-nginx-lb
        - --publish-service=ingress-nginx-controller 